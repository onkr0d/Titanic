{
	# Global options
	admin off
	# email your-email@example.com  # Change this to your email for Let's Encrypt notifications
}

http://compress.ivan.boston {
	redir https://compress.ivan.boston
}

# for dev
localhost:443 {
	tls internal
	reverse_proxy localhost:5000
}

# Proxy from port 5000
compress.ivan.boston {
	encode gzip

	# Allow large file uploads (10GB)
	# request_body {
	# 	max_size 10GB
	# }

	# Log all requests
	log {
		output stdout
		format console
		# format filter {
		# 	request>headers>Cookie cookie {
		# 		replace X-Firebase-AppCheck REDACTED

		# 	}
		# }
	}

	@health {
		path /health
    }
	
    handle @health {
        respond 200
    }

	# Reverse proxy to flask service
	reverse_proxy localhost:5000 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
	}
}
